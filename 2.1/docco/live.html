<!DOCTYPE html>

<html>
<head>
  <title>live.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="component.html">
                component.js
              </a>
            
              
              <a class="source" href="grid.html">
                grid.js
              </a>
            
              
              <a class="source" href="compute.html">
                compute.js
              </a>
            
              
              <a class="source" href="construct.html">
                construct.js
              </a>
            
              
              <a class="source" href="proxy.html">
                proxy.js
              </a>
            
              
              <a class="source" href="super.html">
                super.js
              </a>
            
              
              <a class="source" href="control.html">
                control.js
              </a>
            
              
              <a class="source" href="key.html">
                key.js
              </a>
            
              
              <a class="source" href="modifier.html">
                modifier.js
              </a>
            
              
              <a class="source" href="plugin.html">
                plugin.js
              </a>
            
              
              <a class="source" href="route.html">
                route.js
              </a>
            
              
              <a class="source" href="view.html">
                view.js
              </a>
            
              
              <a class="source" href="list.html">
                list.js
              </a>
            
              
              <a class="source" href="promise.html">
                promise.js
              </a>
            
              
              <a class="source" href="attributes.html">
                attributes.js
              </a>
            
              
              <a class="source" href="backup.html">
                backup.js
              </a>
            
              
              <a class="source" href="delegate.html">
                delegate.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="map_benchmark.html">
                map_benchmark.js
              </a>
            
              
              <a class="source" href="setter.html">
                setter.js
              </a>
            
              
              <a class="source" href="sort.html">
                sort.js
              </a>
            
              
              <a class="source" href="validations.html">
                validations.js
              </a>
            
              
              <a class="source" href="cached.html">
                cached.js
              </a>
            
              
              <a class="source" href="local.html">
                local.js
              </a>
            
              
              <a class="source" href="model.html">
                model.js
              </a>
            
              
              <a class="source" href="queue.html">
                queue.js
              </a>
            
              
              <a class="source" href="store.html">
                store.js
              </a>
            
              
              <a class="source" href="observe.html">
                observe.js
              </a>
            
              
              <a class="source" href="pushstate.html">
                pushstate.js
              </a>
            
              
              <a class="source" href="route.html">
                route.js
              </a>
            
              
              <a class="source" href="all.html">
                all.js
              </a>
            
              
              <a class="source" href="each.html">
                each.js
              </a>
            
              
              <a class="source" href="makeArray.html">
                makeArray.js
              </a>
            
              
              <a class="source" href="attr.html">
                attr.js
              </a>
            
              
              <a class="source" href="batch.html">
                batch.js
              </a>
            
              
              <a class="source" href="bind.html">
                bind.js
              </a>
            
              
              <a class="source" href="can.html">
                can.js
              </a>
            
              
              <a class="source" href="deferred.html">
                deferred.js
              </a>
            
              
              <a class="source" href="observer.html">
                observer.js
              </a>
            
              
              <a class="source" href="destroyed.html">
                destroyed.js
              </a>
            
              
              <a class="source" href="dojo-1.8.1.html">
                dojo-1.8.1.js
              </a>
            
              
              <a class="source" href="dojo.html">
                dojo.js
              </a>
            
              
              <a class="source" href="nodelist-traverse.html">
                nodelist-traverse.js
              </a>
            
              
              <a class="source" href="trigger.html">
                trigger.js
              </a>
            
              
              <a class="source" href="event.html">
                event.js
              </a>
            
              
              <a class="source" href="fixture.html">
                fixture.js
              </a>
            
              
              <a class="source" href="fragment.html">
                fragment.js
              </a>
            
              
              <a class="source" href="func.html">
                func.js
              </a>
            
              
              <a class="source" href="function.html">
                function.js
              </a>
            
              
              <a class="source" href="hashchange.html">
                hashchange.js
              </a>
            
              
              <a class="source" href="inserted.html">
                inserted.js
              </a>
            
              
              <a class="source" href="jquery.html">
                jquery.js
              </a>
            
              
              <a class="source" href="library.html">
                library.js
              </a>
            
              
              <a class="source" href="mootools.html">
                mootools.js
              </a>
            
              
              <a class="source" href="mvc.html">
                mvc.js
              </a>
            
              
              <a class="source" href="isplain.html">
                isplain.js
              </a>
            
              
              <a class="source" href="object.html">
                object.js
              </a>
            
              
              <a class="source" href="classize.html">
                classize.js
              </a>
            
              
              <a class="source" href="deparam.html">
                deparam.js
              </a>
            
              
              <a class="source" href="rsplit.html">
                rsplit.js
              </a>
            
              
              <a class="source" href="string.html">
                string.js
              </a>
            
              
              <a class="source" href="util.html">
                util.js
              </a>
            
              
              <a class="source" href="yui.html">
                yui.js
              </a>
            
              
              <a class="source" href="zepto.html">
                zepto.js
              </a>
            
              
              <a class="source" href="bindings.html">
                bindings.js
              </a>
            
              
              <a class="source" href="ejs.html">
                ejs.js
              </a>
            
              
              <a class="source" href="foo.html">
                foo.js
              </a>
            
              
              <a class="source" href="elements.html">
                elements.js
              </a>
            
              
              <a class="source" href="live.html">
                live.js
              </a>
            
              
              <a class="source" href="modifiers.html">
                modifiers.js
              </a>
            
              
              <a class="source" href="mustache.html">
                mustache.js
              </a>
            
              
              <a class="source" href="mustache_benchmark.html">
                mustache_benchmark.js
              </a>
            
              
              <a class="source" href="node_lists.html">
                node_lists.js
              </a>
            
              
              <a class="source" href="render.html">
                render.js
              </a>
            
              
              <a class="source" href="scanner.html">
                scanner.js
              </a>
            
              
              <a class="source" href="scope.html">
                scope.js
              </a>
            
              
              <a class="source" href="view.html">
                view.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>live.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>steal(<span class="hljs-string">'can/util'</span>, <span class="hljs-string">'can/view/elements.js'</span>, <span class="hljs-string">'can/view'</span>, <span class="hljs-string">'can/view/node_lists'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(can, elements, view, nodeLists)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="live-js">live.js</h2>
<p>The live module provides live binding for computes
and can.List.</p>
<p>Currently, it’s API is designed for <code>can/view/render</code>, but
it could easily be used for other purposes.</p>
<h3 id="helper-methods">Helper methods</h3>
<h4 id="setup">setup</h4>
<p><code>setup(HTMLElement, bind(data), unbind(data)) -&gt; data</code></p>
<p>Calls bind right away, but will call unbind
if the element is “destroyed” (removed from the DOM).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> setup = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el, bind, unbind)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Removing an element can call teardown which
unregister the nodeList which calls teardown</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> tornDown = <span class="hljs-literal">false</span>,
			teardown = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">if</span> (!tornDown) {
					tornDown = <span class="hljs-literal">true</span>;
					unbind(data);
					can.unbind.call(el, <span class="hljs-string">'removed'</span>, teardown);
				}
				<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
			}, data = {
				teardownCheck: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(parent)</span> {</span>
					<span class="hljs-keyword">return</span> parent ? <span class="hljs-literal">false</span> : teardown();
				}
			};
		can.bind.call(el, <span class="hljs-string">'removed'</span>, teardown);
		bind(data);
		<span class="hljs-keyword">return</span> data;
	},</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="listen">listen</h4>
<p>Calls setup, but presets bind and unbind to
operate on a compute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		listen = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el, compute, change)</span> {</span>
			<span class="hljs-keyword">return</span> setup(el, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
				compute.bind(<span class="hljs-string">'change'</span>, change);
			}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
				compute.unbind(<span class="hljs-string">'change'</span>, change);
				<span class="hljs-keyword">if</span> (data.nodeList) {
					nodeLists.unregister(data.nodeList);
				}
			});
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="getattributeparts">getAttributeParts</h4>
<p>Breaks up a string like foo=’bar’ into [“foo”,”‘bar’””]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		getAttributeParts = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newVal)</span> {</span>
			<span class="hljs-keyword">return</span> (newVal || <span class="hljs-string">''</span>)
				.replace(<span class="hljs-regexp">/['"]/g</span>, <span class="hljs-string">''</span>)
				.split(<span class="hljs-string">'='</span>);
		}, splice = [].splice;
	<span class="hljs-comment">/**
	 * @property {Object} can.view.live
	 * @parent can.view.static
	 * @release 2.0.4
	 *
	 * Setup live-binding to a compute manually.
	 *
	 * @body
	 *
	 * ## Use
	 *
	 * `can.view.live` is an object with utlitiy methods for setting up
	 * live-binding.  For example, to make an `&lt;h2&gt;`
	 *
	 *
	 *
	 */</span>
	<span class="hljs-keyword">var</span> live = {
		<span class="hljs-comment">/**
		 * @function can.view.live.list
		 * @parent can.view.live
		 * @release 2.0.4
		 *
		 * Live binds a compute's [can.List] incrementally.
		 *
		 *
		 * @param {HTMLElement} el An html element to replace with the live-section.
		 *
		 * @param {can.compute|can.List} list A [can.List] or [can.compute] whose value is a [can.List].
		 *
		 * @param {function(this:*,*,index):String} render(index, index) A function that when called with
		 * the incremental item to render and the index of the item in the list.
		 *
		 * @param {Object} context The `this` the `render` function will be called with.
		 *
		 * @param {HTMLElement} [parentNode] An overwritable parentNode if `el`'s parent is
		 * a documentFragment.
		 *
		 * ## Use
		 *
		 * `can.view.live.list` is used to setup incremental live-binding.
		 *
		 *     // a compute that change's it's list
		 *     var todos = can.compute(function(){
		 *       return new Todo.List({page: can.route.attr("page")})
		 *     })
		 *
		 *     var placeholder = document.createTextNode(" ")
		 *     $("ul#todos").append(placeholder)
		 *
		 *
		 *
		 *     can.view.live.list(
		 *       placeholder,
		 *       todos,
		 *       function(todo, index){
		 *         return "&lt;li&gt;"+todo.attr("name")+"&lt;/li&gt;"
		 *       })
		 *
		 */</span>
		list: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el, compute, render, context, parentNode)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>A nodeList of all elements this live-list manages.
This is here so that if this live list is within another section
that section is able to remove the items in this list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> masterNodeList = [el],</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>A mapping of the index of an item to an array
of elements that represent the item.
Each array is registered so child or parent
live structures can update the elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				itemIndexToNodeListsMap = [],</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>A mapping of items to their indicies’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				indexMap = [],</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Called when items are added to the list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				add = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev, items, index)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Collect new html and mappings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> frag = document.createDocumentFragment(),
						newNodeLists = [],
						newIndicies = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>For each new item,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					can.each(items, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item, key)</span> {</span>
						<span class="hljs-keyword">var</span> itemIndex = can.compute(key + index),</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>get its string content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							itemHTML = render.call(context, item, itemIndex),</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>and convert it into elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							itemFrag = can.view.fragment(itemHTML);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Add those elements to the mappings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						newNodeLists.push(nodeLists.register(can.makeArray(itemFrag.childNodes), <span class="hljs-literal">undefined</span>, masterNodeList));</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Hookup the fragment (which sets up child live-bindings) and
add it to the collection of all added elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						frag.appendChild(can.view.hookup(itemFrag));
						newIndicies.push(itemIndex);
					});</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Check if we are adding items at the end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (!itemIndexToNodeListsMap[index]) {
						elements.after(index === <span class="hljs-number">0</span> ? [text] : itemIndexToNodeListsMap[index - <span class="hljs-number">1</span>], frag);
					} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Add elements before the next index’s first element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> el = itemIndexToNodeListsMap[index][<span class="hljs-number">0</span>];
						can.insertBefore(el.parentNode, frag, el);
					}
					splice.apply(itemIndexToNodeListsMap, [
						index,
						<span class="hljs-number">0</span>
					].concat(newNodeLists));</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>update indices after insert point</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					splice.apply(indexMap, [
						index,
						<span class="hljs-number">0</span>
					].concat(newIndicies));
					<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = index + newIndicies.length, len = indexMap.length; i &lt; len; i++) {
						indexMap[i](i);
					}
				},</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Called when items are removed or when the bindings are torn down.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				remove = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev, items, index, duringTeardown)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>If this is because an element was removed, we should
check to make sure the live elements are still in the page.
If we did this during a teardown, it would cause an infinite loop.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (!duringTeardown &amp;&amp; data.teardownCheck(text.parentNode)) {
						<span class="hljs-keyword">return</span>;
					}
					<span class="hljs-keyword">var</span> removedMappings = itemIndexToNodeListsMap.splice(index, items.length),
						itemsToRemove = [];
					can.each(removedMappings, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(nodeList)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>add items that we will remove all at once</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						[].push.apply(itemsToRemove, nodeList);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Update any parent lists to remove these items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						nodeLists.update(nodeList, []);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>unregister the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						nodeLists.unregister(nodeList);
					});</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>update indices after remove point</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					indexMap.splice(index, items.length);
					<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = index, len = indexMap.length; i &lt; len; i++) {
						indexMap[i](i);
					}
					can.remove(can.$(itemsToRemove));
				}, text = document.createTextNode(<span class="hljs-string">''</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>The current list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				list,</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Called when the list is replaced with a new list or the binding is torn-down.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				teardownList = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>there might be no list right away, and the list might be a plain
array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (list &amp;&amp; list.unbind) {
						list.unbind(<span class="hljs-string">'add'</span>, add)
							.unbind(<span class="hljs-string">'remove'</span>, remove);
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>use remove to clean stuff up for us</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					remove({}, {
						length: itemIndexToNodeListsMap.length
					}, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
				},</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Called when the list is replaced or setup.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				updateList = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev, newList, oldList)</span> {</span>
					teardownList();</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>make an empty list if the compute returns null or undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					list = newList || [];</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>list might be a plain array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (list.bind) {
						list.bind(<span class="hljs-string">'add'</span>, add)
							.bind(<span class="hljs-string">'remove'</span>, remove);
					}
					add({}, list, <span class="hljs-number">0</span>);
				};
			parentNode = elements.getParentNode(el, parentNode);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Setup binding and teardown to add and remove events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> data = setup(parentNode, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">if</span> (can.isFunction(compute)) {
					compute.bind(<span class="hljs-string">'change'</span>, updateList);
				}
			}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">if</span> (can.isFunction(compute)) {
					compute.unbind(<span class="hljs-string">'change'</span>, updateList);
				}
				teardownList();
			});
			live.replace(masterNodeList, text, data.teardownCheck);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>run the list setup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			updateList({}, can.isFunction(compute) ? compute() : compute);
		},
		<span class="hljs-comment">/**
		 * @function can.view.live.html
		 * @parent can.view.live
		 * @release 2.0.4
		 *
		 * Live binds a compute's value to a collection of elements.
		 *
		 *
		 * @param {HTMLElement} el An html element to replace with the live-section.
		 *
		 * @param {can.compute} compute A [can.compute] whose value is HTML.
		 *
		 * @param {HTMLElement} [parentNode] An overwritable parentNode if `el`'s parent is
		 * a documentFragment.
		 *
		 * ## Use
		 *
		 * `can.view.live.html` is used to setup incremental live-binding.
		 *
		 *     // a compute that change's it's list
		 *     var greeting = can.compute(function(){
		 *       return "Welcome &lt;i&gt;"+me.attr("name")+"&lt;/i&gt;"
		 *     });
		 *
		 *     var placeholder = document.createTextNode(" ");
		 *     $("#greeting").append(placeholder);
		 *
		 *     can.view.live.html( placeholder,  greeting );
		 *
		 */</span>
		html: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el, compute, parentNode)</span> {</span>
			<span class="hljs-keyword">var</span> data;
			parentNode = elements.getParentNode(el, parentNode);
			data = listen(parentNode, compute, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev, newVal, oldVal)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>TODO: remove teardownCheck in 2.1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> attached = nodes[<span class="hljs-number">0</span>].parentNode;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>update the nodes in the DOM with the new rendered value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (attached) {
					makeAndPut(newVal);
				}
				data.teardownCheck(nodes[<span class="hljs-number">0</span>].parentNode);
			});

			<span class="hljs-keyword">var</span> nodes = [el],
				makeAndPut = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val)</span> {</span>
					<span class="hljs-keyword">var</span> frag = can.view.fragment(<span class="hljs-string">''</span> + val),
						oldNodes = can.makeArray(nodes);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>We need to mark each node as belonging to the node list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					nodeLists.update(nodes, frag.childNodes);
					frag = can.view.hookup(frag, parentNode);
					elements.replace(oldNodes, frag);
				};
			data.nodeList = nodes;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>register the span so nodeLists knows the parentNodeList</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			nodeLists.register(nodes, data.teardownCheck);
			makeAndPut(compute());
		},
		<span class="hljs-comment">/**
		 * @function can.view.live.replace
		 * @parent can.view.live
		 * @release 2.0.4
		 *
		 * Replaces one element with some content while keeping [can.view.live.nodeLists nodeLists] data
		 * correct.
		 *
		 * @param {Array.&lt;HTMLElement&gt;} nodes An array of elements.  There should typically be one element.
		 * @param {String|HTMLElement|DocumentFragment} val The content that should replace
		 * `nodes`.  If a string is passed, it will be [can.view.hookup hookedup].
		 *
		 * @param {function} [teardown] A callback if these elements are torn down.
		 */</span>
		replace: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(nodes, val, teardown)</span> {</span>
			<span class="hljs-keyword">var</span> oldNodes = nodes.slice(<span class="hljs-number">0</span>),
				frag;
			nodeLists.register(nodes, teardown);
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val === <span class="hljs-string">'string'</span>) {
				frag = can.view.fragment(val);
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val.nodeType !== <span class="hljs-number">11</span>) {
				frag = document.createDocumentFragment();
				frag.appendChild(val);
			} <span class="hljs-keyword">else</span> {
				frag = val;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>We need to mark each node as belonging to the node list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			nodeLists.update(nodes, frag.childNodes);
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val === <span class="hljs-string">'string'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>if it was a string, check for hookups</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				frag = can.view.hookup(frag, nodes[<span class="hljs-number">0</span>].parentNode);
			}
			elements.replace(oldNodes, frag);
			<span class="hljs-keyword">return</span> nodes;
		},
		<span class="hljs-comment">/**
		 * @function can.view.live.text
		 * @parent can.view.live
		 * @release 2.0.4
		 *
		 * Replaces one element with some content while keeping [can.view.live.nodeLists nodeLists] data
		 * correct.
		 */</span>
		text: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el, compute, parentNode)</span> {</span>
			<span class="hljs-keyword">var</span> parent = elements.getParentNode(el, parentNode);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>setup listening right away so we don’t have to re-calculate value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> data = listen(parent, compute, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev, newVal, oldVal)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Sometimes this is ‘unknown’ in IE and will throw an exception if it is</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-comment">/* jshint ignore:start */</span>
				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> node.nodeValue !== <span class="hljs-string">'unknown'</span>) {
					node.nodeValue = <span class="hljs-string">''</span> + newVal;
				}
				<span class="hljs-comment">/* jshint ignore:end */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>TODO: remove in 2.1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				data.teardownCheck(node.parentNode);
			}),</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>The text node that will be updated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				node = document.createTextNode(compute());</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Replace the placeholder with the live node and do the nodeLists thing.
Add that node to nodeList so we can remove it when the parent element is removed from the page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			data.nodeList = live.replace([el], node, data.teardownCheck);
		},
		<span class="hljs-comment">/**
		 * @function can.view.live.text
		 * @parent can.view.live
		 *
		 * Replaces one element with some content while keeping [can.view.live.nodeLists nodeLists] data
		 * correct.
		 */</span>
		attributes: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el, compute, currentValue)</span> {</span>
			<span class="hljs-keyword">var</span> setAttrs = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newVal)</span> {</span>
				<span class="hljs-keyword">var</span> parts = getAttributeParts(newVal),
					newAttrName = parts.shift();</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Remove if we have a change and used to have an <code>attrName</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (newAttrName !== attrName &amp;&amp; attrName) {
					elements.removeAttr(el, attrName);
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Set if we have a new <code>attrName</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (newAttrName) {
					elements.setAttr(el, newAttrName, parts.join(<span class="hljs-string">'='</span>));
					attrName = newAttrName;
				}
			};
			listen(el, compute, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev, newVal)</span> {</span>
				setAttrs(newVal);
			});</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>current value has been set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt;= <span class="hljs-number">3</span>) {
				<span class="hljs-keyword">var</span> attrName = getAttributeParts(currentValue)[<span class="hljs-number">0</span>];
			} <span class="hljs-keyword">else</span> {
				setAttrs(compute());
			}
		},
		attributePlaceholder: <span class="hljs-string">'__!!__'</span>,
		attributeReplace: <span class="hljs-regexp">/__!!__/g</span>,
		attribute: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el, attributeName, compute)</span> {</span>
			listen(el, compute, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev, newVal)</span> {</span>
				elements.setAttr(el, attributeName, hook.render());
			});
			<span class="hljs-keyword">var</span> wrapped = can.$(el),
				hooks;</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Get the list of hookups or create one for this element.
Hooks is a map of attribute names to hookup <code>data</code>s.
Each hookup data has:
<code>render</code> - A <code>function</code> to render the value of the attribute.
<code>funcs</code> - A list of hookup <code>function</code>s on that attribute.
<code>batchNum</code> - The last event <code>batchNum</code>, used for performance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			hooks = can.data(wrapped, <span class="hljs-string">'hooks'</span>);
			<span class="hljs-keyword">if</span> (!hooks) {
				can.data(wrapped, <span class="hljs-string">'hooks'</span>, hooks = {});
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Get the attribute value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> attr = elements.getAttr(el, attributeName),</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Split the attribute value by the template.
Only split out the first <strong>!!</strong> so if we have multiple hookups in the same attribute,
they will be put in the right spot on first render</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				parts = attr.split(live.attributePlaceholder),
				goodParts = [],
				hook;
			goodParts.push(parts.shift(), parts.join(live.attributePlaceholder));</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>If we already had a hookup for this attribute…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (hooks[attributeName]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Just add to that attribute’s list of <code>function</code>s.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				hooks[attributeName].computes.push(compute);
			} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Create the hookup data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				hooks[attributeName] = {
					render: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
						<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>attr doesn’t have a value in IE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							newAttr = attr ? attr.replace(live.attributeReplace, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
								<span class="hljs-keyword">return</span> elements.contentText(hook.computes[i++]());
							}) : elements.contentText(hook.computes[i++]());
						<span class="hljs-keyword">return</span> newAttr;
					},
					computes: [compute],
					batchNum: <span class="hljs-literal">undefined</span>
				};
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Save the hook for slightly faster performance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			hook = hooks[attributeName];</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Insert the value in parts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			goodParts.splice(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, compute());</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Set the attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			elements.setAttr(el, attributeName, goodParts.join(<span class="hljs-string">''</span>));
		},
		specialAttribute: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(el, attributeName, compute)</span> {</span>
			listen(el, compute, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ev, newVal)</span> {</span>
				elements.setAttr(el, attributeName, getValue(newVal));
			});
			elements.setAttr(el, attributeName, getValue(compute()));
		}
	};
	<span class="hljs-keyword">var</span> newLine = <span class="hljs-regexp">/(\r|\n)+/g</span>;
	<span class="hljs-keyword">var</span> getValue = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val)</span> {</span>
		<span class="hljs-keyword">var</span> regexp = <span class="hljs-regexp">/^["'].*["']$/</span>;
		val = val.replace(elements.attrReg, <span class="hljs-string">''</span>)
			.replace(newLine, <span class="hljs-string">''</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>check if starts and ends with “ or ‘</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">return</span> regexp.test(val) ? val.substr(<span class="hljs-number">1</span>, val.length - <span class="hljs-number">2</span>) : val;
	};
	can.view.live = live;
	can.view.nodeLists = nodeLists;
	can.view.elements = elements;
	<span class="hljs-keyword">return</span> live;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
